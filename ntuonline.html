<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Control Center</title>

<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
margin:0;
font-family:Arial;
background:#0f172a;
color:white;
}

header{
background:#1e293b;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

.section{
padding:20px;
}

.card{
background:#1e293b;
padding:15px;
border-radius:15px;
margin-bottom:20px;
}

button{
padding:6px 12px;
border:none;
border-radius:20px;
background:#f97316;
color:white;
cursor:pointer;
margin-top:5px;
}

button:hover{opacity:0.85;}

input,textarea{
width:100%;
padding:8px;
margin-top:6px;
border-radius:8px;
border:none;
}

.stat{
font-size:18px;
margin-bottom:10px;
}
</style>
</head>

<body>

<header>
<h2><i class="fa-solid fa-shield"></i> Admin Control Center</h2>
<button onclick="logout()">Logout</button>
</header>

<div class="section">

<!-- DASHBOARD -->
<div class="card">
<h3>ðŸ“Š Dashboard Stats</h3>
<div id="stats"></div>
</div>

<!-- LIVE CONTROL -->
<div class="card">
<h3>ðŸ”´ Live Stream Control</h3>
<input id="liveId" placeholder="YouTube Video ID">
<input id="liveTitle" placeholder="Live Title">
<input id="liveDuration" type="number" placeholder="Auto End (minutes)">
<button onclick="startLive()">Start Live</button>
<button onclick="endLive()">End Live</button>
<div id="liveStatus"></div>
</div>

<!-- EVENT MANAGEMENT -->
<div class="card">
<h3>ðŸ“… Event Management</h3>

<input id="eventTitle" placeholder="Title">
<textarea id="eventDesc" placeholder="Description"></textarea>
<input id="eventDate" type="date">
<input id="eventImage" placeholder="Image URL">
<input id="eventVideo" placeholder="Video URL">
<input id="eventAudio" placeholder="Audio URL">
<button onclick="createEvent()">Create Event</button>

<div id="eventList"></div>
</div>

<!-- FEED MODERATION -->
<div class="card">
<h3>ðŸ“° Feed Moderation</h3>
<div id="feedList"></div>
</div>

<!-- CHAT MODERATION -->
<div class="card">
<h3>ðŸ’¬ Global Chat Moderation</h3>
<div id="chatList"></div>
<button onclick="clearChat()">Clear All Chat</button>
</div>

<!-- USERS -->
<div class="card">
<h3>ðŸ‘¥ Users</h3>
<div id="userList"></div>
</div>

</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDA02mVmQxC_cu2QCyq4NN8LhQIWo50V5A",
    authDomain: "ntudioka-online-c29d8.firebaseapp.com",
    projectId: "ntudioka-online-c29d8",
    storageBucket: "ntudioka-online-c29d8.firebasestorage.app",
    messagingSenderId: "1015621578149",
    appId: "1:1015621578149:web:c755b458e505fd32928c4c",
    measurementId: "G-JPVKYQRKEB"
  };
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();

//////////////// ACCESS CONTROL //////////////////

auth.onAuthStateChanged(user=>{
if(!user || user.email!=="fintech.zubysworld@gmail.com"){
alert("Unauthorized Access");
window.location="index.html";
}
});

function logout(){
auth.signOut().then(()=>{
window.location="index.html";
});
}

//////////////// DASHBOARD STATS //////////////////

function loadStats(){
Promise.all([
db.collection("users").get(),
db.collection("feed").get(),
db.collection("events").get(),
db.collection("chat").get()
]).then(([users,feed,events,chat])=>{
stats.innerHTML=`
<div class="stat">Total Users: ${users.size}</div>
<div class="stat">Total Posts: ${feed.size}</div>
<div class="stat">Total Events: ${events.size}</div>
<div class="stat">Total Chat Messages: ${chat.size}</div>
`;
});
}

loadStats();

//////////////// LIVE //////////////////

function startLive(){
db.collection("live").doc("current").set({
videoId:liveId.value,
title:liveTitle.value,
created:Date.now()
});

if(liveDuration.value){
setTimeout(()=>{
endLive();
},liveDuration.value*60000);
}
}

function endLive(){
db.collection("live").doc("current").delete();
}

db.collection("live").doc("current")
.onSnapshot(doc=>{
if(doc.exists){
liveStatus.innerHTML="Live is Active";
}else{
liveStatus.innerHTML="Live is Offline";
}
});

//////////////// EVENTS //////////////////

function createEvent(){
db.collection("events").add({
title:eventTitle.value,
description:eventDesc.value,
date:eventDate.value,
image:eventImage.value||null,
video:eventVideo.value||null,
audio:eventAudio.value||null,
created:Date.now()
});
eventTitle.value="";
eventDesc.value="";
eventDate.value="";
eventImage.value="";
eventVideo.value="";
eventAudio.value="";
}

db.collection("events").orderBy("created","desc")
.onSnapshot(snapshot=>{
eventList.innerHTML="";
snapshot.forEach(doc=>{
const e=doc.data();
eventList.innerHTML+=`
<div class="card">
<h4>${e.title}</h4>
<button onclick="deleteEvent('${doc.id}')">Delete</button>
</div>
`;
});
});

function deleteEvent(id){
db.collection("events").doc(id).delete();
}

//////////////// FEED //////////////////

db.collection("feed").orderBy("created","desc")
.onSnapshot(snapshot=>{
feedList.innerHTML="";
snapshot.forEach(doc=>{
const f=doc.data();
feedList.innerHTML+=`
<div class="card">
<p>${f.text}</p>
<small>${f.user}</small><br>
<button onclick="deletePost('${doc.id}')">Delete</button>
</div>
`;
});
});

function deletePost(id){
db.collection("feed").doc(id).delete();
}

//////////////// CHAT //////////////////

db.collection("chat").orderBy("created")
.onSnapshot(snapshot=>{
chatList.innerHTML="";
snapshot.forEach(doc=>{
const m=doc.data();
chatList.innerHTML+=`
<p><b>${m.user}</b>: ${m.text}
<button onclick="deleteChat('${doc.id}')">X</button></p>
`;
});
});

function deleteChat(id){
db.collection("chat").doc(id).delete();
}

function clearChat(){
db.collection("chat").get().then(snapshot=>{
snapshot.forEach(doc=>{
doc.ref.delete();
});
});
}

//////////////// USERS //////////////////

db.collection("users")
.onSnapshot(snapshot=>{
userList.innerHTML="";
snapshot.forEach(doc=>{
const u=doc.data();
userList.innerHTML+=`
<p>${u.email} ${u.online?"ðŸŸ¢":"âš«"}</p>
`;
});
});
</script>

</body>
</html>
