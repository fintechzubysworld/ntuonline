<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ntudioka Admin</title>

<!-- âœ… ONLY THESE FIREBASE SCRIPTS -->
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-storage-compat.js"></script>

<style>
body{background:#0e0f17;color:white;font-family:sans-serif;padding:30px}
input,textarea{width:100%;padding:10px;margin-top:10px;border-radius:10px}
button{padding:10px 20px;margin-top:10px;border:none;border-radius:20px;background:#00e5ff}
.card{background:#1a1e2f;padding:20px;border-radius:20px;margin-bottom:20px}
</style>
</head>

<body>

<h1>âš¡ Ntudioka Admin Panel</h1>
  <!-- ğŸ” LOGIN -->
<div class="card">
<h2>Admin Login</h2>
<input id="adminEmail" placeholder="Admin email">
<input id="adminPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="card">
<h2>ğŸ“Š Dashboard Overview</h2>
<div id="stats"></div>
</div>

<div class="card">
<h2>ğŸ™ Upload Podcast</h2>
<input type="file" id="podcastFile" accept="audio/*">
<input type="text" id="podcastTitle" placeholder="Podcast title">
<button onclick="uploadPodcast()">Upload</button>
</div>

<div class="card">
<h2>ğŸ¥ Upload Video Post</h2>
<input type="file" id="videoFile" accept="video/*">
<button onclick="uploadVideo()">Upload</button>
</div>

<div class="card">
<h2>ğŸ”´ Publish Live Stream</h2>
<input id="liveId" placeholder="YouTube Video ID">
<button onclick="setLive()">Go Live</button>
</div>
<script>

/////////////////////////////
// âœ… FIREBASE CONFIG (ONLY ONE)
/////////////////////////////

const firebaseConfig = {
  apiKey: "AIzaSyDA02mVmQxC_cu2QCyq4NN8LhQIWo50V5A",
  authDomain: "ntudioka-online-c29d8.firebaseapp.com",
  projectId: "ntudioka-online-c29d8",
  storageBucket: "ntudioka-online-c29d8.appspot.com",
  messagingSenderId: "1015621578149",
  appId: "1:1015621578149:web:c755b458e505fd32928c4c"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const auth = firebase.auth();
const storage = firebase.storage();

auth.onAuthStateChanged(async user=>{
  if(!user){
    alert("Login required");
    location.href="index.html";
    return;
  }

  const doc = await db.collection("roles").doc(user.uid).get();

  if(!doc.exists || doc.data().role !== "admin"){
    alert("Access denied. Not an admin.");
    location.href="index.html";
  }
});


/////////////////////////////
// ğŸ” LOGIN
/////////////////////////////

function login(){
  const email=document.getElementById("adminEmail").value;
  const pass=document.getElementById("adminPass").value;

  auth.signInWithEmailAndPassword(email,pass)
  .then(()=>alert("Admin logged in"))
  .catch(e=>alert(e.message));
}

/////////////////////////////
// ğŸ™ PODCAST UPLOAD
/////////////////////////////

async function uploadPodcast(){

  const file=document.getElementById("podcastFile").files[0];
  const title=document.getElementById("podcastTitle").value;

  if(!file || !title) return alert("Complete fields");

  const ref=storage.ref("podcasts/"+Date.now()+"_"+file.name);
  await ref.put(file);

  const url=await ref.getDownloadURL();

  await db.collection("podcasts").add({
    title:title,
    audioUrl:url,
    created:firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("Podcast uploaded");
}

/////////////////////////////
// ğŸ”´ LIVE BROADCAST
/////////////////////////////

async function setLive(){
  const id=document.getElementById("liveId").value;

  await db.collection("live").doc("current").set({
    videoId:id,
    time:firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("Live stream published");
}
/////////////////////////////
// ğŸ“… EVENT
/////////////////////////////

async function postEvent(){
 const title=document.getElementById("eventTitle").value;

 await db.collection("posts").add({
   text:"ğŸ“… EVENT: "+title,
   admin:true,
   time:Date.now()
 });

 alert("Event posted");
}

/////////////////////////////
// ğŸ”— LINKS
/////////////////////////////

async function addLink(){
 const label=document.getElementById("linkLabel").value;
 const url=document.getElementById("linkURL").value;

 await db.collection("links").add({label,url});
 alert("Link added");
}

/////////////////////////////
// ğŸ¥ VIDEO UPLOAD
/////////////////////////////

async function uploadVideo(){

  const file=document.getElementById("videoFile").files[0];
  if(!file) return alert("Select video");

  const ref=storage.ref("videos/"+Date.now()+"_"+file.name);
  await ref.put(file);

  const url=await ref.getDownloadURL();

  await db.collection("posts").add({
    video:url,
    admin:true,
    time:firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("Video uploaded");
}
async function loadStats(){

 const users=await db.collection("users").get();
 const posts=await db.collection("posts").get();
 const podcasts=await db.collection("podcasts").get();

 document.getElementById("stats").innerHTML=
 `
 ğŸ‘¥ Users: ${users.size}<br>
 ğŸ“ Posts: ${posts.size}<br>
 ğŸ™ Podcasts: ${podcasts.size}<br>
 `;
}

loadStats();
</script>

</body>
</html>




