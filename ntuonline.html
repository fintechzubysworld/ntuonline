<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ntudioka Admin</title>

<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-storage-compat.js"></script>

<style>
body{background:#0e0f17;color:white;font-family:sans-serif;padding:25px}
.card{background:#1a1e2f;padding:20px;border-radius:15px;margin-bottom:20px}
input{width:100%;padding:10px;margin-top:8px;border-radius:10px}
button{padding:10px 18px;margin-top:10px;border:none;border-radius:15px;background:#00e5ff}
</style>
</head>

<body>

<h1>âš¡ Ntudioka Admin Dashboard</h1>

<div class="card">
<h3>Login</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="card">
<h3>ðŸŽ™ Upload Podcast</h3>
<input type="file" id="podFile" accept="audio/*">
<input id="podTitle" placeholder="Podcast title">
<button onclick="uploadPodcast()">Upload</button>
</div>

<div class="card">
<h3>ðŸŽ¥ Upload Video Post</h3>
<input type="file" id="videoFile" accept="video/*">
<button onclick="uploadVideo()">Upload Video</button>
</div>

<div class="card">
<h3>ðŸ”´ Publish Live Stream</h3>
<input id="liveId" placeholder="YouTube Video ID">
<button onclick="setLive()">Go Live</button>
</div>

<script>
const firebaseConfig={
 apiKey:"AIzaSyDA02mVmQxC_cu2QCyq4NN8LhQIWo50V5A",
 authDomain:"ntudioka-online-c29d8.firebaseapp.com",
 projectId:"ntudioka-online-c29d8",
 storageBucket:"ntudioka-online-c29d8.appspot.com",
 messagingSenderId:"1015621578149",
 appId:"1:1015621578149:web:c755b458e505fd32928c4c"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const auth=firebase.auth();
const storage=firebase.storage();

//////////////// LOGIN + ROLE CHECK //////////////////

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .then(()=>checkAdmin())
 .catch(e=>alert(e.message));
}

async function checkAdmin(){
 const uid=auth.currentUser.uid;
 const doc=await db.collection("roles").doc(uid).get();
 if(!doc.exists||doc.data().role!=="admin"){
   alert("Not an admin");
   location.href="index.html";
 }
}

//////////////// PODCAST //////////////////

async function uploadPodcast(){
 const file=podFile.files[0];
 const title=podTitle.value;
 if(!file||!title)return alert("Complete fields");

 const ref=storage.ref("podcasts/"+Date.now()+"_"+file.name);
 await ref.put(file);
 const url=await ref.getDownloadURL();

 await db.collection("podcasts").add({
   title,
   audioUrl:url,
   created:Date.now()
 });
 alert("Podcast uploaded");
}

//////////////// VIDEO //////////////////

async function uploadVideo(){
 const file=videoFile.files[0];
 if(!file)return alert("Select file");

 const ref=storage.ref("videos/"+Date.now()+"_"+file.name);
 await ref.put(file);
 const url=await ref.getDownloadURL();

 await db.collection("posts").add({
   video:url,
   admin:true,
   time:Date.now()
 });
 alert("Video uploaded");
}

//////////////// LIVE //////////////////

async function setLive(){
 await db.collection("live").doc("current").set({
   videoId:liveId.value,
   time:Date.now()
 });
 alert("Live published");
}
</script>
</body>
</html>
