<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Admin ¬∑ Ntuconnect Chat</title><!-- Firebase --><script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script><!-- Font Awesome --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter','Segoe UI',Roboto,sans-serif;background:linear-gradient(145deg,#0b201c,#0f2d27);color:#e0f2ee;padding:18px}header{background:rgba(26,128,114,0.85);backdrop-filter:blur(12px);padding:1rem 2rem;border-radius:60px;margin-bottom:2rem;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:15px;box-shadow:0 15px 30px -8px rgba(0,160,140,0.4);border:1px solid rgba(90,220,190,0.3)}header h2{color:#fff;font-weight:500;letter-spacing:-0.5px;display:flex;align-items:center;gap:10px}.card{background:rgba(20,55,48,0.7);backdrop-filter:blur(12px);border-radius:36px;padding:26px;margin-bottom:28px;border:1px solid rgba(80,210,180,0.2);box-shadow:0 25px 35px -18px #000}h3{color:#64e3cf;margin-bottom:18px;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:10px;border-bottom:2px solid #1f6f62;padding-bottom:12px}input,textarea,select,button{font-size:16px}input,textarea,select{width:100%;padding:14px 18px;margin:8px 0;border-radius:50px;border:none;background:#0f332d;color:#f0fdfa;border:1px solid transparent}input:focus,textarea:focus,select:focus{outline:none;border-color:#3bc6b2;background:#15453d;box-shadow:0 0 0 3px rgba(55,200,180,0.2)}button{background:#1f8f7c;border:none;padding:12px 28px;border-radius:60px;color:#fff;font-weight:600;cursor:pointer;margin-right:8px;margin-bottom:8px;min-height:48px;box-shadow:0 6px 14px rgba(20,130,110,0.4);transition:.2s;border:1px solid rgba(255,255,255,0.1)}button:hover{background:#2fa892;transform:scale(1.02)}button.secondary{background:#2d5b52}button.secondary:hover{background:#3e786c}.table-wrapper{overflow-x:auto;margin:20px 0}table{width:100%;border-collapse:collapse;min-width:520px}th,td{text-align:left;padding:14px 10px;border-bottom:1px solid #22665b}th{background:#0f332d;color:#a0f2e0;font-weight:500}.admin-badge{background:#2dab95;color:#0a1f1b;padding:5px 12px;border-radius:40px;font-weight:600}.user-badge{background:#3f6a61;padding:5px 12px;border-radius:40px}.message{padding:12px;border-radius:30px;margin:12px 0;display:none}.success{background:#2dab95;color:#0b1f1b;display:block}.error{background:#b54a3f;color:#fff;display:block}.moderation-item{background:#0f332d;border-radius:28px;padding:20px;margin:15px 0;border-left:6px solid #2dab95;word-break:break-word}.moderation-meta{font-size:.85rem;color:#b2ddd4;margin-bottom:10px}.delete-btn{background:#b54a3f;padding:8px 20px;border-radius:30px;font-size:.9rem}.delete-btn:hover{background:#c45f54}.tab-buttons{display:flex;gap:10px;margin-bottom:25px;flex-wrap:wrap}.tab-btn{background:#2d5b52;color:#fff;border:none;padding:12px 20px;border-radius:50px;cursor:pointer;font-size:.95rem;transition:.2s}.tab-btn.active{background:#2dab95;color:#0a1f1b;font-weight:600;box-shadow:0 6px 14px rgba(45,171,149,0.5)}.tab-content{display:none}.tab-content.active{display:block}@media (max-width:480px){body{padding:12px}header{flex-direction:column;text-align:center}.card{padding:18px}button{width:100%;margin-right:0}}
</style></head><body><header><h2><i class="fa-solid fa-water" style="color:#a2ffee;"></i> Admin ¬∑ Chat</h2><div><span id="userEmail" style="margin-right:15px;color:#d0f7f0;"></span><button onclick="logout()">Logout</button><button onclick="window.location='index.html'">‚Üê Community</button></div></header><div id="authCheck" style="display:none;text-align:center;padding:50px"><h3>Checking authorization...</h3></div><div id="dashboard" style="display:none;"><!-- CHANGE PASSWORD --><div class="card"><h3><i class="fa-solid fa-key"></i> Change Password</h3><input type="password" id="currentPass" placeholder="Current Password"><input type="password" id="newPass" placeholder="New Password"><input type="password" id="confirmNewPass" placeholder="Confirm New Password"><button onclick="changePassword()">Update Password</button><div id="passMessage" class="message"></div></div><!-- MANAGE ADMINS --><div class="card"><h3><i class="fa-solid fa-user-tie"></i> Manage Administrators</h3><div class="table-wrapper"><table><thead><tr><th>Name</th><th>Email</th><th>Kindred</th><th>Role</th><th>Action</th></tr></thead><tbody id="userList"></tbody></table></div><div id="adminMessage" class="message"></div></div><!-- MODERATION PANEL (only chat and replies) --><div class="card"><h3><i class="fa-solid fa-gavel"></i> Moderate Content</h3><div class="tab-buttons"><button class="tab-btn active" data-tab="chat">Chat Messages</button><button class="tab-btn" data-tab="replies">Chat Replies</button></div><div id="tab-chat" class="tab-content active"><div id="moderateChat"></div></div><div id="tab-replies" class="tab-content"><div id="moderateReplies"></div></div></div></div><script>
const firebaseConfig={apiKey:"AIzaSyDA02mVmQxC_cu2QCyq4NN8LhQIWo50V5A",authDomain:"ntudioka-online-c29d8.firebaseapp.com",projectId:"ntudioka-online-c29d8",storageBucket:"ntudioka-online-c29d8.firebasestorage.app",messagingSenderId:"1015621578149",appId:"1:1015621578149:web:c755b458e505fd32928c4c",measurementId:"G-JPVKYQRKEB"};firebase.initializeApp(firebaseConfig);const auth=firebase.auth(),db=firebase.firestore(),SUPER_ADMIN_EMAIL="fintech.zubysworld@gmail.com";let currentUser=null;const authCheckDiv=document.getElementById('authCheck'),dashboardDiv=document.getElementById('dashboard'),userEmailSpan=document.getElementById('userEmail');function showError(e){alert("Error: "+e.message);console.error(e)}function showMessage(e,t,n){const i=document.getElementById(e);i.textContent=t;i.className=`message ${n}`;setTimeout(()=>{i.style.display='none'},5000)}auth.onAuthStateChanged(e=>{if(e){userEmailSpan.textContent=e.email;db.collection('users').doc(e.uid).get().then(t=>{let n=t.exists&&t.data().isAdmin===!0;if(!n&&e.email===SUPER_ADMIN_EMAIL)return db.collection('users').doc(e.uid).set({isAdmin:!0},{merge:!0}).then(()=>db.collection('users').doc(e.uid).get()).then(i=>{n=i.data().isAdmin});}).then(()=>db.collection('users').doc(e.uid).get()).then(t=>{if(t.exists&&t.data().isAdmin===!0){currentUser=e;authCheckDiv.style.display='none';dashboardDiv.style.display='block';loadUsers();loadAllContent();}else{authCheckDiv.innerHTML='<h3>Access Denied. You are not an administrator.</h3><button onclick="window.location=\'index.html\'">Go Home</button>';authCheckDiv.style.display='block';}}).catch(showError)}else window.location.href='index.html'});window.logout=function(){auth.signOut().then(()=>window.location.href='index.html').catch(showError)};function loadUsers(){db.collection('users').get().then(e=>{const t=document.getElementById('userList');t.innerHTML='';e.forEach(e=>{const n=e.data(),i=e.id,l=n.isAdmin||!1;t.innerHTML+=`<tr><td>${n.name||'?'}</td><td>${n.email||'?'}</td><td>${n.kindred||'?'}</td><td><span class="${l?'admin-badge':'user-badge'}">${l?'ADMIN':'USER'}</span></td><td><button class="secondary" onclick="toggleAdmin('${i}',${l})">${l?'Revoke':'Make Admin'}</button></td></tr>`})}).catch(showError)}window.toggleAdmin=function(e,t){if(!confirm(`Are you sure you want to ${t?'revoke admin from':'grant admin to'} this user?`))return;db.collection('users').doc(e).update({isAdmin:!t}).then(()=>{showMessage('adminMessage','User role updated','success');loadUsers()}).catch(e=>showMessage('adminMessage',e.message,'error'))};window.changePassword=function(){const e=document.getElementById('currentPass').value,t=document.getElementById('newPass').value,n=document.getElementById('confirmNewPass').value;if(!e||!t||!n)return showMessage('passMessage','All fields required','error');if(t!==n)return showMessage('passMessage','Passwords do not match','error');if(t.length<6)return showMessage('passMessage','Password too short','error');const i=auth.currentUser,l=firebase.auth.EmailAuthProvider.credential(i.email,e);i.reauthenticateWithCredential(l).then(()=>i.updatePassword(t)).then(()=>{showMessage('passMessage','Password updated','success');document.getElementById('currentPass').value=document.getElementById('newPass').value=document.getElementById('confirmNewPass').value=''}).catch(e=>showMessage('passMessage',e.message,'error'))};async function deleteDocumentAndSubcollections(e){const t=await e.get();if(!t.exists)return;const n=await e.listCollections(),i=[];for(const l of n){const n=await l.get();n.forEach(e=>{i.push(deleteDocumentAndSubcollections(e.ref))})}await Promise.all(i);await e.delete();console.log(`Deleted: ${e.path}`)}window.deleteItem=function(e){if(!confirm('Permanently delete this item and all its replies?'))return;console.log(`Deleting: ${e}`);const t=db.doc(e);deleteDocumentAndSubcollections(t).then(()=>alert('Deleted successfully')).catch(e=>{console.error('Delete error:',e);showError(e)})};function loadAllContent(){db.collection('chat').orderBy('created','desc').get().then(e=>{const t=document.getElementById('moderateChat');t.innerHTML='';e.forEach(e=>{const n=e.data();t.innerHTML+=`<div class="moderation-item"><div class="moderation-meta">üí¨ Chat | ${n.name} (${n.kindred}) | ${new Date(n.created).toLocaleString()}</div><div>${n.text||''}</div><button class="delete-btn" onclick="deleteItem('chat/${e.id}')"><i class="fa-regular fa-trash-can"></i> Delete</button></div>`})}).catch(showError);const e=document.getElementById('moderateReplies');e.innerHTML='';function t(t){return db.collection(t).get().then(n=>{const i=[];return n.forEach(n=>{i.push(n.ref.collection('replies').orderBy('created','desc').get().then(i=>{i.forEach(i=>{const l=i.data();e.innerHTML+=`<div class="moderation-item"><div class="moderation-meta">‚Ü≥ Reply in ${t} | ${l.name} (${l.kindred}) | ${new Date(l.created).toLocaleString()}</div><div>${l.text||''}</div><button class="delete-btn" onclick="deleteItem('${t}/${n.id}/replies/${i.id}')">Delete</button></div>`})}))}),Promise.all(i)})}e.innerHTML='';Promise.all([t('chat')]).catch(showError)}document.querySelectorAll('.tab-btn').forEach(e=>{e.addEventListener('click',()=>{document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));e.classList.add('active');document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));document.getElementById('tab-'+e.dataset.tab).classList.add('active')})});
</script></body></html>
