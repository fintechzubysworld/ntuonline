<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ntudioka Online</title>

<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#0f172a,#1e293b);
color:white;
}

header{
padding:20px;
background:#0ea5e9;
display:flex;
justify-content:space-between;
align-items:center;
}

button{
padding:8px 15px;
border:none;
border-radius:20px;
cursor:pointer;
background:#f97316;
color:white;
}

.section{
padding:20px;
}

.card{
background:#1e293b;
padding:15px;
border-radius:15px;
margin-bottom:15px;
}

input,textarea{
width:100%;
padding:8px;
margin-top:6px;
border-radius:10px;
border:none;
}

.live{
border:2px solid red;
}

.commentBox{
margin-top:10px;
}
</style>
</head>

<body>

<header>
<h2><i class="fa-solid fa-globe"></i> Ntudioka Online</h2>
<div>
<button onclick="showLogin()">Login</button>
<button onclick="showRegister()">Register</button>
<button onclick="goAdmin()">Admin</button>
</div>
</header>

<div class="section">

<h2>ğŸ”´ Live Stream</h2>
<div id="liveContainer"></div>

<h2>ğŸ“… Events</h2>
<div id="eventContainer"></div>

<h2>ğŸ’¬ Community Feed</h2>
<div id="feedContainer"></div>

</div>

<!-- LOGIN MODAL -->
<div id="authArea" style="display:none;padding:20px;">
<h3 id="authTitle"></h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="submitAuth()">Submit</button>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDA02mVmQxC_cu2QCyq4NN8LhQIWo50V5A",
authDomain:"ntudioka-online-c29d8.firebaseapp.com",
projectId:"ntudioka-online-c29d8"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();

let mode="login";

function showLogin(){
authArea.style.display="block";
authTitle.innerText="Login";
mode="login";
}

function showRegister(){
authArea.style.display="block";
authTitle.innerText="Register";
mode="register";
}

function submitAuth(){
const e=email.value;
const p=password.value;

if(mode==="register"){
auth.createUserWithEmailAndPassword(e,p)
.then(()=>{
alert("Registration successful!");
email.value="";
password.value="";
authArea.style.display="none";
});
}else{
auth.signInWithEmailAndPassword(e,p)
.then(()=>{
alert("Login successful!");
email.value="";
password.value="";
authArea.style.display="none";
});
}
}

function goAdmin(){
if(auth.currentUser && auth.currentUser.email==="fintech.zubysworld@gmail.com"){
window.location="ntuonline.html";
}else{
alert("Admin access denied.");
}
}

//////////////// LIVE STREAM //////////////////

db.collection("live").doc("current")
.onSnapshot(doc=>{
liveContainer.innerHTML="";
if(doc.exists){
const d=doc.data();
liveContainer.innerHTML=`
<div class="card live">
<h3>${d.title}</h3>
<iframe width="100%" height="315"
src="https://www.youtube.com/embed/${d.videoId}"
allowfullscreen></iframe>
</div>`;
}else{
liveContainer.innerHTML="<p>Currently offline</p>";
}
});

//////////////// EVENTS //////////////////

db.collection("events").orderBy("created","desc")
.onSnapshot(s=>{
eventContainer.innerHTML="";
s.forEach(doc=>{
const e=doc.data();

eventContainer.innerHTML+=`
<div class="card">
<h3>${e.title}</h3>
<p>${e.description}</p>
<p><b>Date:</b> ${e.date}</p>

${e.image?`<img src="${e.image}" width="100%">`:""}
${e.video?`<iframe width="100%" height="315" src="${e.video}" allowfullscreen></iframe>`:""}
${e.audio?`<audio controls style="width:100%;"><source src="${e.audio}" type="audio/mpeg"></audio>`:""}

<div class="commentBox">
<textarea id="c${doc.id}" placeholder="Write comment"></textarea>
<button onclick="comment('${doc.id}')">Comment</button>
</div>

<div id="comments${doc.id}"></div>

</div>`;

db.collection("events").doc(doc.id).collection("comments")
.onSnapshot(cs=>{
let html="";
cs.forEach(c=>{
html+=`<p>ğŸ’¬ ${c.data().text}</p>`;
});
document.getElementById("comments"+doc.id).innerHTML=html;
});
});
});

function comment(id){
if(!auth.currentUser) return alert("Login required");
const text=document.getElementById("c"+id).value;
db.collection("events").doc(id).collection("comments")
.add({text:text,user:auth.currentUser.email});
document.getElementById("c"+id).value="";
}

//////////////// FEED //////////////////

db.collection("feed").orderBy("created","desc")
.onSnapshot(s=>{
feedContainer.innerHTML="";
s.forEach(doc=>{
const f=doc.data();
feedContainer.innerHTML+=`
<div class="card">
<p>${f.text}</p>
<button onclick="react('${doc.id}')">ğŸ‘ Like</button>
<span id="like${doc.id}">${f.likes||0}</span>
</div>`;
});
});

function react(id){
if(!auth.currentUser) return alert("Login required");
db.collection("feed").doc(id).update({
likes:firebase.firestore.FieldValue.increment(1)
});
}
</script>

</body>
</html>
