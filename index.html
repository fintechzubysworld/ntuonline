<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Ntuconnect ¬∑ Chat</title><link rel="manifest" href="manifest.json"><!-- Firebase --><script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script><!-- Font Awesome --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter','Segoe UI',Roboto,system-ui,sans-serif;background:linear-gradient(145deg,#0b1f1c,#0e2b26);color:#e0f0ec;line-height:1.5;min-height:100vh;padding:16px}header{background:rgba(26,138,120,0.85);backdrop-filter:blur(12px);padding:.9rem 1.8rem;border-radius:60px;margin-bottom:2rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 15px 30px -8px rgba(0,180,160,0.4);border:1px solid rgba(100,230,210,0.3)}header h2{font-weight:500;font-size:1.6rem;letter-spacing:-0.5px;display:flex;align-items:center;gap:10px;color:#fff;text-shadow:0 2px 5px rgba(0,80,70,0.3)}#navArea{display:flex;align-items:center;gap:12px;flex-wrap:wrap}#navArea button{background:#1f8a7c;border:none;padding:8px 18px;border-radius:40px;color:#fff;font-weight:600;font-size:.95rem;cursor:pointer;transition:.2s;box-shadow:0 6px 14px rgba(22,150,130,0.3);min-height:44px;border:1px solid rgba(255,255,255,0.1)}#navArea button:hover{background:#2ba48f;transform:scale(1.02);box-shadow:0 10px 20px rgba(0,140,120,0.5)}.onlineDot{color:#8cffe0;font-weight:600;margin-right:6px;font-size:.95rem;text-shadow:0 0 5px #64ffda}.section{max-width:1300px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:24px}.card{background:rgba(18,45,40,0.7);backdrop-filter:blur(12px);border-radius:32px;padding:24px;box-shadow:0 30px 45px -20px rgba(0,0,0,0.6);border:1px solid rgba(80,210,180,0.2);transition:.25s}.card:hover{border-color:rgba(90,235,200,0.5);transform:translateY(-3px)}.card h3{color:#64e3cf;margin-bottom:16px;font-size:1.4rem;font-weight:500;display:flex;align-items:center;gap:10px;border-bottom:2px solid #1f6a5e;padding-bottom:10px;letter-spacing:-0.3px}input,textarea,button{font-size:16px}input,textarea{width:100%;padding:14px 18px;margin:8px 0;border-radius:50px;border:none;background:#102f2a;color:#f0fdfa;transition:.2s;border:1px solid transparent}input:focus,textarea:focus{outline:none;border-color:#3bc6b2;background:#133b35;box-shadow:0 0 0 3px rgba(55,200,180,0.2)}textarea{border-radius:28px;resize:vertical}button{background:#1f8f7c;border:none;padding:12px 24px;border-radius:50px;color:#fff;font-weight:600;cursor:pointer;transition:.2s;box-shadow:0 6px 14px rgba(20,130,110,0.4);min-height:48px;display:inline-flex;align-items:center;justify-content:center;gap:8px;border:1px solid rgba(255,255,255,0.1)}button:hover{background:#2fa892;transform:scale(1.01);box-shadow:0 10px 20px rgba(0,140,120,0.6)}button.secondary{background:#2a4a44;box-shadow:none}button.secondary:hover{background:#3c635b}.chat-item{background:#0f2d27;border-radius:24px;padding:18px;margin:18px 0;border-left:5px solid #2dab95;box-shadow:0 10px 15px -5px rgba(0,0,0,0.5)}.replyBox{margin-left:16px;padding-left:16px;border-left:3px solid #2a6b5f;margin-top:12px}.timestamp{font-size:.7rem;color:#9bc5bc;margin-top:8px}.embedded-media{margin:12px 0;border-radius:20px;overflow:hidden}.embedded-media img,.embedded-media iframe{max-width:100%;border-radius:20px}.embedded-media iframe{height:210px}.reaction-bar{margin-top:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}.reaction-btn{background:0 0;border:none;color:#b2d9d2;cursor:pointer;padding:8px 18px;border-radius:40px;transition:.2s;display:inline-flex;align-items:center;gap:8px;font-size:.9rem}.reaction-btn:hover{background:#1d4d44}.reaction-btn.liked{color:#64ffda;font-weight:600}.modal{position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,30,25,0.8);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:16px}.modal-content{background:#1b423b;padding:28px 26px;border-radius:48px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;color:#fff;border:2px solid #3bc6b2;box-shadow:0 30px 50px #00000060;position:relative}.close{position:absolute;top:18px;right:22px;font-size:32px;font-weight:300;cursor:pointer;color:#a0ddd2;line-height:1;transition:.2s}.close:hover{color:#a2ffee;transform:scale(1.1)}#authContainer.modal{display:none}#authContainer .modal-content{background:#1f4f47}.chat-messages{max-height:300px;overflow-y:auto;margin:15px 0;padding:12px;background:#10332e;border-radius:28px}.chat-message{margin-bottom:10px;padding:8px 14px;border-radius:22px;max-width:80%;word-wrap:break-word}.chat-message.sent{background:#1f8f7c;color:#fff;margin-left:auto}.chat-message.received{background:#2b5a51;color:#fff;margin-right:auto}.chat-input-area{display:flex;gap:10px;flex-wrap:wrap}.chat-input-area input{flex:1 1 200px;margin:0}.inbox-list{max-height:400px;overflow-y:auto}.inbox-item{display:flex;align-items:center;justify-content:space-between;padding:16px;background:#10332e;border-radius:40px;margin-bottom:12px;cursor:pointer;gap:12px;transition:background .2s}.inbox-item:hover{background:#1b5349}.inbox-item-name{font-weight:600;color:#64ffda}.inbox-item-preview{font-size:.85rem;color:#b0ddd4}.marquee{width:100%;overflow:hidden;background:#0d312b;padding:8px 0;margin-bottom:20px;border-radius:60px;border:1px solid #3a887b}.marquee h6{display:inline-block;margin:0;font-size:.9rem;color:#b5ffe8;animation:scrollText 22s linear infinite;white-space:nowrap;font-weight:400;letter-spacing:.5px}@keyframes scrollText{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}.clickable-name{color:#a2ffee;font-weight:600;cursor:pointer;text-decoration:none}@media (max-width:480px){body{padding:10px}header{padding:.7rem 1.2rem}.card{padding:18px}button{width:100%}.embedded-media iframe{height:200px}.modal-content{padding:20px}}.unread-badge{background:#ff6b4a;color:#fff;border-radius:20px;padding:2px 8px;font-size:.8rem;margin-left:8px;display:inline-block;font-weight:600}
</style></head><body><header><h2><i class="fa-solid fa-water" style="color:#8cffe0;"></i> Ntuconnect ¬∑ Chat</h2><div id="navArea"></div></header><div class="marquee"><h6>‚ö° Powered by Zuby's World IT solutions. For all your business solutions, contact us via: fintech.zubysworld@gmail.com</h6></div><div class="section"><div class="card"><h3><i class="fa-regular fa-message"></i> Community Chat</h3><div id="chatArea"></div><input id="chatInput" placeholder="Type a message..."><button onclick="sendChat()"><i class="fa-regular fa-paper-plane"></i> Send</button></div></div><div id="authContainer" class="modal" style="display:none"><div class="modal-content"><span class="close" onclick="document.getElementById('authContainer').style.display='none'">&times;</span><h3 id="authHeader" style="color:#8cffe0;">Login</h3><div id="registerFields" style="display:none"><input id="regName" placeholder="Full Name"><input id="regKindred" placeholder="Kindred Name"></div><input id="authEmail" placeholder="Email"><input id="authPassword" type="password" placeholder="Password"><button id="authSubmitBtn" style="background:#1f8f7c;">Login</button><p style="margin-top:15px"><span id="toggleText">Don't have an account?</span> <a href="#" onclick="toggleAuthMode(event)" style="color:#8cffe0;font-weight:600">Click here</a></p><div id="authMessage"></div></div></div><div id="profileModal" class="modal" style="display:none"><div class="modal-content"><span class="close" onclick="closeProfileModal()">&times;</span><h3><i class="fa-regular fa-user"></i> User Profile</h3><div id="profileInfo"></div><button id="startPrivateChatBtn" onclick="startPrivateChatFromProfile()">üí¨ Private Chat</button></div></div><div id="inboxModal" class="modal" style="display:none"><div class="modal-content"><span class="close" onclick="closeInboxModal()">&times;</span><h3><i class="fa-regular fa-envelope"></i> Inbox</h3><div id="inboxList" class="inbox-list">Loading...</div></div></div><div id="chatModal" class="modal" style="display:none"><div class="modal-content chat-modal"><span class="close" onclick="closeChatModal()">&times;</span><h3 id="chatWith"></h3><div id="privateChatMessages" class="chat-messages"></div><div class="chat-input-area"><input type="text" id="privateChatInput" placeholder="Type a message..."><button onclick="sendPrivateMessage()">Send</button></div></div></div><script>
const firebaseConfig={apiKey:"AIzaSyDA02mVmQxC_cu2QCyq4NN8LhQIWo50V5A",authDomain:"ntudioka-online-c29d8.firebaseapp.com",projectId:"ntudioka-online-c29d8",storageBucket:"ntudioka-online-c29d8.firebasestorage.app",messagingSenderId:"1015621578149",appId:"1:1015621578149:web:c755b458e505fd32928c4c",measurementId:"G-JPVKYQRKEB"};firebase.initializeApp(firebaseConfig);const auth=firebase.auth(),db=firebase.firestore();let currentUser=null;
function parseContent(e){if(!e)return'';const t=/(https?:\/\/[^\s]+)/g,n=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})(?:[^\s]*)/g,i=/(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|bmp|svg))(?:\?.*)?/gi;let r=[],l=0,o;for(;null!==(o=t.exec(e));){const s=o[0],a=o.index;if(a>l&&r.push({type:'text',content:e.substring(l,a)}),n.exec(s))r.push({type:'youtube',content:RegExp.$1});else if(i.test(s))r.push({type:'image',content:s});else r.push({type:'link',content:s});l=a+s.length}if(l<e.length&&r.push({type:'text',content:e.substring(l)}),0===r.length)return escapeHtml(e);let d='';return r.forEach(e=>{'text'===e.type?d+=escapeHtml(e.content):'link'===e.type?d+=`<a href="${e.content}" target="_blank" rel="noopener" style="color:#8cffe0;">${e.content}</a>`:'image'===e.type?d+=`<div class="embedded-media"><img src="${e.content}" alt="embedded image" loading="lazy"></div>`:'youtube'===e.type&&(d+=`<div class="embedded-media"><iframe src="https://www.youtube.com/embed/${e.content}" allowfullscreen></iframe></div>`)}),d}
function escapeHtml(e){return e.replace(/[&<>"']/g,function(e){return'&'===e?'&amp;':'<'===e?'&lt;':'>'===e?'&gt;':'"'===e?'&quot;':'&#039;'})}
function formatTimestamp(e){if(!e)return'';try{let t=e.toDate?e.toDate():new Date(e);return isNaN(t.getTime())?'':t.toLocaleString()}catch(e){return''}}
function formatRelativeTime(e){if(!e)return'';try{let t=e.toDate?e.toDate():new Date(e);if(isNaN(t.getTime()))return'';let n=Math.floor((Date.now()-t)/1e3);return n<60?'just now':n<3600?Math.floor(n/60)+'m ago':n<86400?Math.floor(n/3600)+'h ago':Math.floor(n/86400)+'d ago'}catch(e){return''}}
function addReactionUI(e,t,n){const i=document.createElement('div');i.className='reaction-bar';i.innerHTML=`<button class="reaction-btn like-btn" data-type="${e}" data-id="${t}"><i class="fa-regular fa-thumbs-up"></i> <span class="reaction-count">0</span></button>`;n.appendChild(i);const r=i.querySelector('.like-btn'),l=r.querySelector('.reaction-count'),o=currentUser?.uid;let s;e.includes('/')?s=t?db.collection(e).doc(t):db.doc(e):s=db.collection(e).doc(t);const a=s.collection('reactions'),d=a.onSnapshot(e=>{let n=0,i=!1;e.forEach(e=>{'like'===e.data().type&&(n++,o&&e.id===o&&(i=!0))});l.textContent=n;i?(r.classList.add('liked'),r.innerHTML=`<i class="fa-solid fa-thumbs-up"></i> <span class="reaction-count">${n}</span>`):(r.classList.remove('liked'),r.innerHTML=`<i class="fa-regular fa-thumbs-up"></i> <span class="reaction-count">${n}</span>`)});return r.addEventListener('click',async()=>{if(!currentUser)return alert('Login required');const e=a.doc(currentUser.uid),t=await e.get();t.exists?await e.delete():await e.set({type:'like',createdAt:firebase.firestore.FieldValue.serverTimestamp()})}),d}
let authMode='login';const navArea=document.getElementById('navArea'),authContainer=document.getElementById('authContainer');window.showAuth=function(){authContainer.style.display='flex'};
window.toggleAuthMode=function(e){e.preventDefault(),authMode='login'===authMode?'register':'login',document.getElementById('registerFields').style.display='register'===authMode?'block':'none',document.getElementById('authHeader').innerText='login'===authMode?'Login':'Register',document.getElementById('authSubmitBtn').innerText='login'===authMode?'Login':'Register',document.getElementById('toggleText').innerText='login'===authMode?"Don't have an account?":"Already have an account?"};
document.getElementById('authSubmitBtn').onclick=function(){const e=document.getElementById('authEmail').value.trim(),t=document.getElementById('authPassword').value.trim();if('register'===authMode){const n=document.getElementById('regName').value.trim(),i=document.getElementById('regKindred').value.trim();if(!n||!i||!e||!t)return alert('All fields required');auth.createUserWithEmailAndPassword(e,t).then(e=>db.collection('users').doc(e.user.uid).set({name:n,kindred:i,email:e,online:!0,lastSeen:null,createdAt:firebase.firestore.FieldValue.serverTimestamp(),isAdmin:!1})).then(()=>{alert('Registered'),authContainer.style.display='none',clearAuth()}).catch(showError)}else auth.signInWithEmailAndPassword(e,t).then(()=>{alert('Login successful'),authContainer.style.display='none',clearAuth()}).catch(showError)};
function clearAuth(){document.getElementById('authEmail').value='',document.getElementById('authPassword').value='',document.getElementById('regName')&&(document.getElementById('regName').value=''),document.getElementById('regKindred')&&(document.getElementById('regKindred').value='')}
window.logout=function(){currentUser&&db.collection('users').doc(currentUser.uid).update({online:!1,lastSeen:firebase.firestore.FieldValue.serverTimestamp()}).catch(showError),auth.signOut().catch(showError)};
auth.onAuthStateChanged(e=>{if(currentUser=e,e){db.collection('users').doc(e.uid).update({online:!0}).catch(showError),db.collection('users').doc(e.uid).get().then(t=>{const n=t.data()||{},i=n.isAdmin||!1;navArea.innerHTML=`<span class="onlineDot">‚óè Online</span><button onclick="showInbox()"><i class="fa-regular fa-envelope"></i> Inbox</button><button onclick="logout()">Logout</button>${i?'<button onclick="window.location=\'ntuonline.html\'">Admin</button>':''}`}).catch(showError)}else navArea.innerHTML='<button onclick="showAuth()">Login / Register</button>'}),window.addEventListener('beforeunload',()=>{currentUser&&db.collection('users').doc(currentUser.uid).update({online:!1,lastSeen:firebase.firestore.FieldValue.serverTimestamp()}).catch(showError)});
function showError(e){alert('Error: '+e.message),console.error(e)}
window.sendChat=function(){if(!currentUser)return alert('Login required');const e=document.getElementById('chatInput');if(!e.value.trim())return;db.collection('users').doc(currentUser.uid).get().then(t=>{const n=t.data()||{};return db.collection('chat').add({text:e.value,name:n.name??null,kindred:n.kindred??null,userId:currentUser.uid,created:Date.now()})}).then(()=>{e.value=''}).catch(showError)};
db.collection('chat').orderBy('created').onSnapshot(e=>{const t=document.getElementById('chatArea');t.innerHTML='',e.forEach(e=>{const n=e.data(),i=e.id,r=document.createElement('div');r.className='chat-item',r.innerHTML=`<strong><span class="clickable-name" onclick="showProfile('${n.userId||''}')">${n.name??'?'}</span> (${n.kindred??'?'})</strong><span>: ${parseContent(n.text)}</span><div class="timestamp">${formatTimestamp(n.created)}</div><div id="chatReplies${i}" class="replies"></div><input id="chatReplyInput${i}" placeholder="Reply..."><button onclick="replyChat('${i}')">Reply</button>`,t.appendChild(r),addReactionUI('chat',i,r),loadChatReplies(i)})},showError);
window.replyChat=function(e){if(!currentUser)return alert('Login required');const t=document.getElementById('chatReplyInput'+e);if(!t||!t.value.trim())return;db.collection('users').doc(currentUser.uid).get().then(n=>{const i=n.data()||{};return db.collection('chat').doc(e).collection('replies').add({text:t.value,name:i.name??null,kindred:i.kindred??null,userId:currentUser.uid,created:Date.now()})}).then(()=>{t.value=''}).catch(showError)};
function loadChatReplies(e){db.collection('chat').doc(e).collection('replies').orderBy('created').onSnapshot(t=>{const n=document.getElementById('chatReplies'+e);if(!n)return;n.innerHTML='',t.forEach(t=>{const i=t.data(),r=document.createElement('div');r.className='replyBox',r.innerHTML=`<strong><span class="clickable-name" onclick="showProfile('${i.userId||''}')">${i.name??'?'}</span> (${i.kindred??'?'})</strong>: ${parseContent(i.text)}<div class="timestamp">${formatTimestamp(i.created)}</div>`,n.appendChild(r),addReactionUI(`chat/${e}/replies`,t.id,r)})},showError)}
let currentProfileUserId=null;window.showProfile=function(e){if(!e)return;db.collection('users').doc(e).get().then(t=>{if(!t.exists)return;const n=t.data();document.getElementById('profileInfo').innerHTML=`<p><strong>Name:</strong> ${n.name||'?'}</p><p><strong>Kindred:</strong> ${n.kindred||'?'}</p><p><strong>Email:</strong> ${n.email||'?'}</p><p><strong>Status:</strong> ${n.online?'üü¢ Online':'üî¥ Offline'}</p>`,currentProfileUserId=e,document.getElementById('profileModal').style.display='flex'}).catch(showError)};window.closeProfileModal=function(){document.getElementById('profileModal').style.display='none',currentProfileUserId=null};window.startPrivateChatFromProfile=function(){currentProfileUserId&&(startPrivateChat(currentProfileUserId),closeProfileModal())};
let activeChatRoomId=null,activeChatOtherUserId=null,unsubscribeRoomMessages=null;function getChatRoomId(e,t){return[e,t].sort().join('_')}window.startPrivateChat=async function(e){if(!currentUser)return alert('Login required');if(e===currentUser.uid)return alert('Cannot chat with yourself');const t=getChatRoomId(currentUser.uid,e);activeChatRoomId=t,activeChatOtherUserId=e;const n=db.collection('privateChatRooms').doc(t),i=await n.get();i.exists||await n.set({participants:[currentUser.uid,e],createdAt:firebase.firestore.FieldValue.serverTimestamp(),lastMessage:null,lastMessageTime:null});n.collection('messages').where('from','==',e).where('read','==',!1).get().then(e=>{const t=db.batch();return e.forEach(e=>t.update(e.ref,{read:!0})),t.commit()}).catch(showError);db.collection('users').doc(e).get().then(e=>{const t=e.data();document.getElementById('chatWith').innerHTML=`Chat with ${t.name||'User'}`}),document.getElementById('chatModal').style.display='flex',document.getElementById('privateChatInput').focus();const r=n.collection('messages').orderBy('timestamp','asc');unsubscribeRoomMessages&&unsubscribeRoomMessages(),unsubscribeRoomMessages=r.onSnapshot(e=>{const t=document.getElementById('privateChatMessages');t.innerHTML='',e.forEach(e=>{const n=e.data(),i=document.createElement('div');i.className=`chat-message ${n.from===currentUser.uid?'sent':'received'}`;i.innerHTML=`<div>${parseContent(n.text)}</div><small>${n.timestamp?.toDate?n.timestamp.toDate().toLocaleTimeString():''}</small>`,t.appendChild(i)}),t.scrollTop=t.scrollHeight},showError)};window.sendPrivateMessage=function(){const e=document.getElementById('privateChatInput'),t=e.value.trim();if(!t||!activeChatRoomId)return;const n=db.collection('privateChatRooms').doc(activeChatRoomId);n.collection('messages').add({from:currentUser.uid,text,timestamp:firebase.firestore.FieldValue.serverTimestamp(),read:!1}).then(()=>{n.update({lastMessage:t,lastMessageTime:firebase.firestore.FieldValue.serverTimestamp()}).catch(showError),e.value=''}).catch(showError)};window.closeChatModal=function(){document.getElementById('chatModal').style.display='none',unsubscribeRoomMessages&&(unsubscribeRoomMessages(),unsubscribeRoomMessages=null),activeChatRoomId=null,activeChatOtherUserId=null};window.showInbox=function(){document.getElementById('inboxModal').style.display='flex',loadInbox()};window.closeInboxModal=function(){document.getElementById('inboxModal').style.display='none'};
function loadInbox(){if(!currentUser)return;const e=document.getElementById('inboxList');e.innerHTML='Loading...',db.collection('privateChatRooms').where('participants','array-contains',currentUser.uid).get().then(async t=>{if(t.empty){e.innerHTML='<p>No conversations yet.</p>';return}const n=[];for(const i of t.docs){const r=i.data(),l=r.participants.find(e=>e!==currentUser.uid),o=await db.collection('users').doc(l).get(),s=o.data()||{name:'Unknown'},a=await db.collection('privateChatRooms').doc(i.id).collection('messages').where('from','==',l).where('read','==',!1).get(),d=a.size;let u=r.lastMessage||'No messages';u.length>30&&(u=u.substring(0,30)+'‚Ä¶');let c=r.lastMessageTime?formatRelativeTime(r.lastMessageTime):'';n.push({id:i.id,otherUid:l,otherName:s.name||'User',preview:u,time:c,lastMessageTime:r.lastMessageTime?r.lastMessageTime.toDate():new Date(0),unreadCount:d})}n.sort((e,t)=>t.lastMessageTime-e.lastMessageTime),e.innerHTML='',n.forEach(t=>{const n=document.createElement('div');n.className='inbox-item',n.onclick=()=>{closeInboxModal(),startPrivateChat(t.otherUid)};const i=t.unreadCount>0?`<span class="unread-badge">${t.unreadCount}</span>`:'';n.innerHTML=`<div class="inbox-item-info"><div class="inbox-item-name">${t.otherName} ${i}</div><div class="inbox-item-preview">${t.preview}</div></div><div class="inbox-item-time">${t.time}</div>`,e.appendChild(n)})}).catch(t=>{console.error('Inbox error:',t),e.innerHTML='<p>Error loading inbox. Please try again.</p>'})}window.onclick=function(e){e.target.classList.contains('modal')&&(e.target.style.display='none','chatModal'===e.target.id&&unsubscribeRoomMessages&&(unsubscribeRoomMessages(),unsubscribeRoomMessages=null,activeChatRoomId=null))};
</script><script>if(typeof navigator.serviceWorker!=='undefined'){navigator.serviceWorker.register('sw.js')}</script></body></html>
