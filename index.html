<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ntudioka Community</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- ‚úÖ ONLY THESE FIREBASE SCRIPTS -->
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-storage-compat.js"></script>

<style>
body{font-family:sans-serif;background:#faf5ea;margin:0}
header{background:#ffb300;padding:15px;color:white;display:flex;justify-content:space-between}
section{max-width:900px;margin:30px auto;padding:15px}
.post{background:white;border-radius:20px;padding:20px;margin-top:15px}
textarea,input{width:100%;padding:10px;margin-top:10px;border-radius:10px;border:1px solid #ccc}
button{padding:10px 20px;border:none;border-radius:20px;background:#ff9800;color:white;margin-top:10px}
audio{width:100%;margin-top:10px}
li{cursor:pointer;margin:6px 0}
</style>
</head>

<body>

<header>
<div><b>üéß Ntudioka Community</b></div>
<div>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="signup()">Sign up</button>
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>
<button onclick="adminLogin()">Admin</button>
</div>
</header>

<!-- üéô PODCAST PLAYER -->
<section>
<h2>üéô Podcasts</h2>

<audio id="audio" controls></audio>

<div>
<button onclick="prevPodcast()">‚èÆ</button>
<button onclick="nextPodcast()">‚è≠</button>
</div>

<ul id="podcastList"></ul>
</section>

<!-- üåç COMMUNITY FEED -->
<section>
<h2>üåç Community Feed</h2>
<textarea id="goodwillInput" placeholder="Write goodwill message..."></textarea>
<button onclick="postGoodwill()">Post</button>
<div id="feed"></div>
</section>

<script>

/////////////////////////////
// ‚úÖ FIREBASE CONFIG (ONLY ONE)
/////////////////////////////

const firebaseConfig = {
  apiKey: "AIzaSyDA02mVmQxC_cu2QCyq4NN8LhQIWo50V5A",
  authDomain: "ntudioka-online-c29d8.firebaseapp.com",
  projectId: "ntudioka-online-c29d8",
  storageBucket: "ntudioka-online-c29d8.appspot.com",
  messagingSenderId: "1015621578149",
  appId: "1:1015621578149:web:c755b458e505fd32928c4c"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const auth = firebase.auth();
const storage = firebase.storage();
</script>
  <script>
auth.onAuthStateChanged(async user=>{
  if(!user){
    alert("Login required");
    location.href="index.html";
    return;
  }

  const doc = await db.collection("roles").doc(user.uid).get();

  if(!doc.exists || doc.data().role !== "admin"){
    alert("Access denied. Not an admin.");
    location.href="index.html";
  }
});
  </script>
  <script>
/////////////////////////////
// ‚úÖ AUTH SYSTEM
/////////////////////////////

function signup(){
  const email=document.getElementById("email").value;
  const pass=document.getElementById("password").value;

  auth.createUserWithEmailAndPassword(email,pass)
  .then(()=>alert("Signup successful"))
  .catch(e=>alert(e.message));
}

function login(){
  const email=document.getElementById("email").value;
  const pass=document.getElementById("password").value;

  auth.signInWithEmailAndPassword(email,pass)
  .then(()=>alert("Logged in"))
  .catch(e=>alert(e.message));
}

function logout(){
  auth.signOut();
}

/////////////////////////////
// ‚úÖ ADMIN BUTTON
/////////////////////////////

function adminLogin(){
 const user=prompt("Admin username");
 const pass=prompt("Admin password");

 if(user==="admin" && pass==="admin123"){
   location.href="ntuonline.html";
 }else{
   alert("Wrong admin login");
 }
}

/////////////////////////////
// ‚úÖ PODCAST PLAYER (FIREBASE CONNECTED)
/////////////////////////////

let playlist=[];
let current=0;
const audio=document.getElementById("audio");

db.collection("podcasts").orderBy("created","desc")
.onSnapshot(s=>{
 const list=document.getElementById("podcastList");
 list.innerHTML="";
 playlist=[];

 s.forEach((doc,i)=>{
   const p=doc.data();
   playlist.push(p.audioUrl);

   const li=document.createElement("li");
   li.innerText="‚ñ∂ "+p.title;
   li.onclick=()=>playPodcast(i);
   list.appendChild(li);
 });
});

function playPodcast(i){
 current=i;
 audio.src=playlist[i];
 audio.play();
}

function nextPodcast(){
 if(current+1<playlist.length){
   playPodcast(current+1);
 }
}

function prevPodcast(){
 if(current>0){
   playPodcast(current-1);
 }
}

audio.onended=nextPodcast;

/////////////////////////////
// ‚úÖ FEED SYSTEM
/////////////////////////////

async function postGoodwill(){
 const txt=document.getElementById("goodwillInput").value;
 const user=auth.currentUser;
 if(!user)return alert("Login required");

 await db.collection("posts").add({
   text:txt,
   email:user.email,
   time:Date.now()
 });

 document.getElementById("goodwillInput").value="";
}

db.collection("posts").orderBy("time","desc")
.onSnapshot(s=>{
 const feed=document.getElementById("feed");
 feed.innerHTML="";
 s.forEach(doc=>{
   const p=doc.data();
   feed.innerHTML+=`
   <div class="post">
   <b>${p.email||"Admin"}</b>
   <p>${p.text||""}</p>
   </div>`;
 });
});

</script>
</body>
</html>


